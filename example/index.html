<html>
<head>
  <meta charset="utf-8">
  <title>Protractor E2E Coverage </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,700' rel='stylesheet' type='text/css'>
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/css/bootstrap.min.css"> -->
  <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

  <link href="style.css" rel="stylesheet">
</head>
<body>
	<div class="container">
		<div class="row">
			<h1>Protractor E2E Coverage</h1>
		</div>

		<div class="row">
			<div class="col-md-6 text-center">
					<h4>Elements seen/Elements interacted</h4>
					<h1 id="interacted-seen"></h1>
			</div>
			<div class="col-md-6 text-center">
					<h4>Coverage percentage</h4>
					<h1 id="coverage-percentage"></h1>
			</div>
		</div>

		<div class="row">
			<table class="table table-striped" id="table">
				<tr>
					<td>#</td>
					<td>Status</td>
					<td>Type</td>
					<td>Events</td>
					<td>Locations triggered</td>
					<td>Locations seen</td>
					<td>Html</td>
					<td>Html safe</td>
				</tr>
			</table>
		</div>

	</div>
	<script type="text/javascript">
		var xmlhttp = new XMLHttpRequest();
		var url = "coverage.json";

		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				var data = JSON.parse(xmlhttp.responseText);
				parseData(data);
			} 
		}

		function safe_tags(str) {
			return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') ;
		}

		function parseData(data) {
			var seen = data.length;
			var interacted = 0;

			var table = document.getElementById('table');
			var count = 0;
			data.forEach(function(item) {
				if(item.tested) interacted += 1;
				count += 1;
				table.appendChild(template(item, count));
			});

			document.getElementById('interacted-seen').innerHTML = seen + '/' + interacted;
			document.getElementById('coverage-percentage').innerHTML = Math.round(seen/interacted) + '%';
		}

		function template(item, id) {
			var s = '' +
				// id
				'<td>' + id + '</td>' + 
				// status
				'<td>' + item.tested + '</td>' + 
				// type
				'<td>' + item.type + '</td>' +
				// events
				'<td>' + item.seen.events + '</td>' +
				// locations seen
				'<td>' + item.seen.locations + '</td>' +
				// locations total
				'<td>' + item.locations + '</td>' +
				// html 
				'<td>' + item.element + '</td>' +
				// html safe
				'<td>' + safe_tags(item.element) + '</td>';
			var tr = document.createElement('tr');
			tr.className = tr.className + (item.tested ? ' success' : ' warning');
			tr.innerHTML = s;
			return tr;
		}

		xmlhttp.open("GET", url, true);
		xmlhttp.send();
	</script>
</body>
</html>